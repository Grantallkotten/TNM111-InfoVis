<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      canvas {
        border: 1px solid #ccc;
      }
    </style>
    <title>Scatter Plot Visualization</title>
  </head>
  <body>
    <canvas id="scatterPlotCanvas" width="600" height="400"></canvas>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Function to read the CSV file
        function readCSV(file, callback) {
          let xhr = new XMLHttpRequest();
          xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
              callback(xhr.responseText);
            }
          };
          xhr.open("GET", file, true);
          xhr.send();
        }

        // Function to parse CSV data
        function parseCSV(csvData) {
          let rows = csvData.split("\n");
          let data = [];
          let dataPoint;

          for (let i = 0; i < rows.length; i++) {
            let columns = rows[i].split(",");
            if (columns.length === 3) {
              data.push({
                x: parseFloat(columns[0]),
                y: parseFloat(columns[1]),
                className: columns[2].trim(),
              });
            }
          }
          return data;
        }

        function drawScatterPlot(data) {
          // Set up the canvas element
          var canvas = document.getElementById("scatterPlotCanvas");
          var ctx = canvas.getContext("2d");
          // set canvas size to window size
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;

          // Set up min and max values
          const minX = data
            .map((point) => point.x)
            .reduce((min, currentX) => Math.min(min, currentX), Infinity);

          const minY = data
            .map((point) => point.y)
            .reduce((min, currentY) => Math.min(min, currentY), Infinity);

          const maxX = data
            .map((point) => point.x)
            .reduce((max, currentX) => Math.max(max, currentX), -Infinity);

          const maxY = data
            .map((point) => point.y)
            .reduce((max, currentY) => Math.max(max, currentY), -Infinity);

          // Calculate scale and offset for the plot
          const scaleX = canvas.width / (maxX - minX);
          const scaleY = -canvas.height / (maxY - minY);

          const screenOrigin = {
            x: 0,
            y: 0,
          };

          const screenCenter = {
            x: canvas.width / 2,
            y: canvas.height / 2,
          };

          let axisPadding = 20;
          if (minX > 0) {
            screenCenter.x = axisPadding;
          }
          if (maxY > 0) {
            screenCenter.y = canvas.height - axisPadding;
          }

          const plotOrigin = {
            x: 0, //canvas.width / 2,
            y: 0, //canvas.height / 2,
          };

          console.log("maxX: " + maxX + "\nminX: " + minX);
          console.log("\n\nmaxY: " + maxY + "\nminY: " + minY);
          console.log("scaleX: " + scaleX + "\nscaleY: " + scaleY);

          ctx.translate(screenCenter.x, screenCenter.y);

          ctx.scale(scaleX * 0.6, scaleY * 0.6);

          // Draw data points
          data.forEach((point) => {
            ctx.beginPath();
            ctx.arc(
              point.x + plotOrigin.x,
              point.y + plotOrigin.y,
              2, // radius
              0, // Start ang
              2 * Math.PI // end ang
            );
            ctx.fillStyle = "blue"; //getColor(point.className); // function for color
            ctx.fill();
            ctx.stroke();
          });

          // Draw x-axis
          ctx.beginPath();
          ctx.moveTo(plotOrigin.x + Math.min(minX, 0), plotOrigin.y); // Move to the bottom-left corner
          ctx.lineTo(plotOrigin.x + maxX, plotOrigin.y); // Draw to the bottom-right corner
          ctx.fillStyle = "black"; //getColor(point.className); // function for color
          ctx.stroke();

          for (
            let x = Math.min(Math.ceil(minX / 5) * 5, 0);
            x <= Math.floor(maxX / 5) * 5;
            x += 5
          ) {
            if (x != 0) {
              const xPos = x;
              const yPos = 0;

              ctx.save();
              ctx.scale(1 / scaleX, 1 / scaleY);
              ctx.font = "24px Arial";
              ctx.fillText(x.toString(), xPos * scaleX, yPos - 20);
              ctx.restore();
            }
          }

          // Draw y-axis
          ctx.beginPath();
          ctx.moveTo(plotOrigin.x, plotOrigin.y + Math.min(minY, 0)); // Move to the top-left corner
          ctx.lineTo(plotOrigin.x, plotOrigin.y + maxY); // Draw to the bottom-left corner
          ctx.fillStyle = "black"; //getColor(point.className); // function for color
          ctx.stroke();

          // Draw y-axis labels
          for (
            let y = Math.min(Math.ceil(minY / 5) * 5, 0);
            y <= Math.floor(maxY / 5) * 5;
            y += 5
          ) {
            if (y != 0) {
              const xPos = 0;
              const yPos = y;

              // Save the current canvas state
              ctx.save();

              // Scale only the text
              ctx.scale(1 / scaleX, 1 / scaleY);

              // Set the font size
              ctx.font = "24px Arial"; // Adjust the font size as needed

              ctx.fillText(y.toString(), xPos + 20, yPos * scaleY); // Adjust the xOffset as needed

              // Restore the previous canvas state
              ctx.restore();
            }
          }
        }

        // Load CSV file on document load
        readCSV("data2.csv", function (csvContent) {
          let csvData = parseCSV(csvContent);
          console.log(csvData);
          drawScatterPlot(csvData);
        });
      });
    </script>
  </body>
</html>
